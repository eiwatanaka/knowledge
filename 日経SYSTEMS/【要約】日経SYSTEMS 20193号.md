## 1. はじめに

以下雑誌の要約。

- 題名：日経SYSTEMS 2019/3号

## 2. CI導入ではまる落とし穴
ITシステムの仕事で今、最も大切なことはスピード開発である。継続的インテグレーション(CI)を始めとしたプロセス改革が求められる。
周囲から「トロい」と言われないためには、IT現場の抜本的な改革が必要である。そのために重要なのは、スピード開発を阻む落とし穴にはまらないことである。落とし穴には大きく分けて技術的な落とし穴と人的な落とし穴がある。
CI導入にて、はまりがちな落とし穴や回避方法について以下にまとめる。

```:継続的インテグレーション(CI)
開発者が変更したソースコードをバージョン管理システムなどのリポジトリーに登録すると、
自動でコンパイルやビルド(結合)、テスト環境へのデプロイ(配置)、テストを実行するための仕組み。
```

#### 2-1. 技術的落とし穴
##### 2-1-1. ジョブがブラックボックス化
- CIツールの役割は、人間が行う面倒な作業をソフトウエアの「ロボット」に代行させること。つまりCIとは、最近注目を集める**RPA(ロボティック・プロセス・オートメーション)**に他ならない。
- CIの落とし穴もRPAに通じるところがある。代表的なのは、RPAで問題視される**野良ロボット**の存在である。誰がいつ作ったのか分からないジョブが現場にまん延し、思わぬ動作を招くことがある。ブラックボックス化したジョブは、開発スピードを阻害する厄介な存在になりかねない。**ジョブの記述はできるだけシンプルにして属人性を排除し、可読性を高める**必要がある。
- **Jenkins**には豊富なプラグインがあり、クリックしながらジョブを容易に作成できる。だが簡単にジョブを作成できるだけに、管理不能の多種多様なジョブが増える恐れがある。

##### 2-1-2. マシンリソースが足りなくなる
- CIによる自動化で効果が大きいのは、テストだとされている。小まめなテストでコード品質を向上させれば、手戻り防止につながるからだ。しかし、テスト環境が非力だと、大量のテストを実行する際に待ち時間が発生しやすい。
- コンテナ仮想化技術**Docker**とコンテナ管理ツール**Kubernetes**を使い、開発者自身が機動的にテスト環境を作成することで、**コストを抑えながらリソース不足を解消することが可能**である。  
開発者がリポジトリにテスト対象のソースコードを登録し、テストの実行を指示する。するとJenkinsがコンテナ化された仮想テスト環境を立ち上げ、テストを実行する。Kubernetesがリソース不足を検知したら、必要に応じて自動的にリソースを割り当てる仕組みである。

##### 2-1-3. テストコード量が増大
- CIを導入すると、膨大なテストコードに押し潰される恐れがある。そもそもCIでは、ソースコードとともにテストコードを用意する必要がある。ソースコードに変更があると、その都度テストコードも変更しなければならず、これが開発スピードを阻害する大きな要因となる。
- テストコード爆発を解消する対策は、**思い切ってある分野のテストはしない**というもの。  
具体的には、画面の裏側で動作する処理については、PCとスマホで動作が同じ点に着目。この場合、PCのみでテストし、スマホ版ではテストしないようにする。  
例えばデータのアップロード処理などは、PCもスマホもロジックは同じ。これを別々にテストしなくても品質を維持できると判断する。

#### 2-2. 人的落とし穴
##### 2-2-1. 際限なく追加要求が来てしまう
- CIの導入によってリリースの期間が短くなると、ユーザーから次々と仕様変更や機能追加が舞い込んでくる可能性が高い。これに対してIT現場は、それらを捌ききれずにパンクしてしまう恐れがある。アジャイルとCI環境を導入していることにより、ユーザーには「すぐに対応してもらえる」と捉えられる場合がある。
- ユーザー要求は、**一見して不要と判断できるものでもその場で回答せず、関係者が集まる会議で合意を得る**ようにすべき。実装すべきかどうかを客観的に可視化すること、関係者とともに合意することが大切である。

##### 2-2-2. ユーザーを巻き込めない
- CIを導入してリリースを早めても、ユーザーをしっかりと巻き込めなければ意図する機能を実現するのは難しい。
- 手戻りの大きな原因は**利用品質**を中心に開発していないこと。利用品質とは、ソフトウェアそのものの品質(機能品質)ではなく、**ソフトウェアを使うユーザーから見た品質**である。アジャイルやCIを導入しても、機能品質ばかりに着目していると、仕様の食い違いは減らない。  
利用品質には**「使いやすさ」「習得・再学習の容易さ」「直感的に理解できること」「ユーザー満足度」**などがある。
- ウォーターフォール型開発に慣れていたり、大規模開発だったりすると、機能品質に着目したプロセスになりがちである。**ユーザーがレビューするための場や時間を明確にする**のがとにかく重要。そうしないと、いつまでたっても仕様の食い違いは起こり得る。

## 3. Jenkinsの疑問
Jenkinsは、ソフトウエア開発者の作業の一部を肩代わりしてくれる「執事」のようなツールである。Jenkinsをサーバーにインストールすれば、ビルドやテストといった面倒な作業(ジョブ)を自動化できる。
CIを実現するツールの定番であるJenkinsについて以下にまとめる。

#### 3-1. Jenkinsを使うと何がうれしい？
- Jenkinsを利用するメリットは、**様々なツールと連携して多種多様なジョブを自動化できること**である。  
- 例えば、ビルドツールと連携すれば、コンパイルや結合、パッケージ化といったアプリケーションのビルド作業を自動実行できる。
このように、ジョブをJenkinsが開発者の代わりに実行することで、ビルド作業の大幅な工数削減につなげられる。また、テストツールと連携させるジョブを登録すれば、Jenkinsによるテストの自動化も実現できる。
実行できる主なジョブは以下の通り。

|機能|概要|
|-----------------|------------------|
|テストの自動化|JUnitやSeleniumなどのテストツールをJenkinsから呼び出すことで、テストの自動化が可能|
|デプロイ作業の自動化|バッチやシェルをJenkins から呼び出すことでデプロイ作業の自動化可能|
|バージョン管理システムとの連携|CVSやSubversion、Gitといったバージョン管理システムとの連携が可能|
|ビルドの自動化|Jenkins から AntやMavenなどのビルドツールを呼び出すことで、コンパイルやビルドの自動化が可能|
|ビルドパイプラインの作成|プログラミング言語のGroovyを使ってビルドの順番などを指定できる|
|ファイルの追跡|JARファイルの生成元などを追跡できる|

#### 3-2. Jenkinsで開発が速くなる？
- Jenkinsを利用すると、**手作業からの解放**という恩恵を得られる。これが開発の高速化につながる。
- ソフトウエア開発では短いソースコードを記述し、意図した通りに動くかを繰り返しテストする。多くの場合はテストコードを記載してテストを実施する。ところが、何度もソースコードを改修してテストを繰り返す場合、いちいち手動でテストを実行するのが負担になる。バージョン管理システムのリポジトリーからソースコードを入手し、そのソースコードを改修、そしてビルドしてテスト環境にデプロイする。このような工程を経て、ようやくテストを実施できるようになる。  
- そこで、Jenkinsによる自動化が重要になる。Jenkinsの設定に「リポジトリーにソースコードが保存されたら、関連するライブラリーを集めてビルドし、テストコードを実行した後、結果をメールで送信する」という処理を記載しておく。手作業から解放されるとともに、大幅な時間短縮となる。

#### 3-3. Jenkinsの導入は難しい？
- まず、Javaの実行環境をサーバーにインストールし、次にJenkinsの公式サイトからWARファイルをダウンロードする。  
続いて、コマンド「java -jarjenkins.war」を使って、WARファイルを実行する。
すると、Jenkinsがサーバーとして起動する。「Jetty」と呼ぶ軽量なWebアプリケーションサーバーが同梱されているので、Apacheなどのサーバーソフトを別途インストールしなくてもネットワーク経由でアクセスできる。  
JenkinsにはWebブラウザーでアクセスする。パスワードなどを設定すると、ダッシュボード画面が表示される。ここからJenkinsでよく利用するジョブをウィザード形式で作成できる。  
このように。Jenkinsは比較的簡単に導入できる。

![j.PNG](https://qiita-image-store.s3.amazonaws.com/0/247638/01037d72-93e8-e29e-0088-072b2f67472b.png)
